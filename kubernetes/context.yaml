schemaVersion: 1
kind: command
metadata:
  name: Context
  slug: context
  description: Switch or list Kubernetes contexts
  tags: [kubernetes, context, config]
  aliases: [ctx]
dependencies: [kubectl]
defaults:
  shell: /bin/bash
  timeout: 10s
args:
  positional:
    - name: name
      description: Context name to switch to (omit for interactive selection)
      required: false
      default: ""
  flags:
    - name: list
      short: l
      type: bool
      description: List all available contexts
      default: "false"
    - name: current
      short: c
      type: bool
      description: Show current context
      default: "false"
steps:
  - name: context
    run: |
      set -euo pipefail
      if [[ "{{.args.list}}" == "true" ]]; then
        kubectl config get-contexts
        exit 0
      fi
      if [[ "{{.args.current}}" == "true" ]]; then
        echo "Current context: $(kubectl config current-context)"
        exit 0
      fi

      NAME="{{.args.name}}"
      if [[ -z "$NAME" ]]; then
        if command -v fzf &>/dev/null; then
          ITEMS=$(kubectl config get-contexts -o name)
          if [[ -z "$ITEMS" ]]; then
            echo "No contexts found."
            exit 1
          fi
          NAME=$(echo "$ITEMS" | fzf --prompt="Select context: ")
          [[ -z "$NAME" ]] && echo "No context selected." && exit 1
        else
          echo "Current context: $(kubectl config current-context)"
          echo ""
          echo "Available contexts:"
          kubectl config get-contexts
          echo ""
          echo "Tip: install fzf for interactive selection"
          exit 1
        fi
      fi
      kubectl config use-context "$NAME"
      echo "Switched to context: $NAME"
