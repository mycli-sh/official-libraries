schemaVersion: 1
kind: command
metadata:
  name: Namespace
  slug: namespace
  description: Switch or list Kubernetes namespaces
  tags: [kubernetes, namespace, config]
  aliases: [ns]
dependencies: [kubectl]
defaults:
  shell: /bin/bash
  timeout: 10s
args:
  positional:
    - name: name
      description: Namespace name to switch to (omit for interactive selection)
      required: false
      default: ""
  flags:
    - name: list
      short: l
      type: bool
      description: List all namespaces
      default: "false"
    - name: current
      short: c
      type: bool
      description: Show current namespace
      default: "false"
steps:
  - name: namespace
    run: |
      set -euo pipefail
      if [[ "{{.args.list}}" == "true" ]]; then
        kubectl get namespaces
        exit 0
      fi
      if [[ "{{.args.current}}" == "true" ]]; then
        NS=$(kubectl config view --minify --output 'jsonpath={..namespace}' 2>/dev/null)
        echo "Current namespace: ${NS:-default}"
        exit 0
      fi

      NAME="{{.args.name}}"
      if [[ -z "$NAME" ]]; then
        if command -v fzf &>/dev/null; then
          NAME=$(kubectl get namespaces --no-headers | awk '{print $1}' | fzf --prompt="Select namespace: ")
          [[ -z "$NAME" ]] && echo "No namespace selected." && exit 1
        else
          NS=$(kubectl config view --minify --output 'jsonpath={..namespace}' 2>/dev/null)
          echo "Current namespace: ${NS:-default}"
          echo ""
          echo "Available namespaces:"
          kubectl get namespaces
          echo ""
          echo "Tip: install fzf for interactive selection"
          exit 1
        fi
      fi
      kubectl config set-context --current --namespace="$NAME"
      echo "Switched to namespace: $NAME"
