schemaVersion: 1
kind: command
metadata:
  name: Edit
  slug: edit
  description: Edit a Kubernetes resource in your default editor
  tags: [kubernetes, edit, config]
dependencies: [kubectl]
defaults:
  shell: /bin/bash
  timeout: "0s"
args:
  positional:
    - name: resource
      description: "Resource type (e.g. pod, service, deployment). Omit for interactive selection"
      required: false
      default: ""
    - name: name
      description: Resource name (omit for interactive selection)
      required: false
      default: ""
  flags:
    - name: namespace
      short: "n"
      type: string
      description: Kubernetes namespace
      default: ""
steps:
  - name: edit
    run: |
      set -euo pipefail
      NS_FLAG=""
      if [[ -n "{{.args.namespace}}" ]]; then NS_FLAG="--namespace={{.args.namespace}}"; fi

      RESOURCE="{{.args.resource}}"
      if [[ -z "$RESOURCE" ]]; then
        if command -v fzf &>/dev/null; then
          RESOURCE=$(printf 'pod\nservice\ndeployment\nstatefulset\ndaemonset\ningress\nconfigmap\nsecret\npvc\njob\ncronjob' | fzf --prompt="Select resource type: ")
          [[ -z "$RESOURCE" ]] && echo "No resource type selected." && exit 1
        else
          echo "No resource type specified. Common types: pod, service, deployment, statefulset, ingress, configmap, secret"
          echo ""
          echo "Tip: install fzf for interactive selection"
          exit 1
        fi
      fi

      NAME="{{.args.name}}"
      if [[ -z "$NAME" ]]; then
        if command -v fzf &>/dev/null; then
          NAME=$(kubectl get "$RESOURCE" --no-headers ${NS_FLAG} | fzf --prompt="Select $RESOURCE: " | awk '{print $1}')
          [[ -z "$NAME" ]] && echo "No resource selected." && exit 1
        else
          echo "No name specified. Available $RESOURCE:"
          kubectl get "$RESOURCE" ${NS_FLAG}
          echo ""
          echo "Tip: install fzf for interactive selection"
          exit 1
        fi
      fi

      ARGS=()
      if [[ -n "${NS_FLAG}" ]]; then ARGS+=(${NS_FLAG}); fi
      kubectl edit "$RESOURCE" "$NAME" ${ARGS[@]+"${ARGS[@]}"}
